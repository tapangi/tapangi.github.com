// Generated by CoffeeScript 1.3.3
var Tapangi, console, renderfeedcell_tweets;

$.fn.serializeObject = function() {
  var a, o;
  o = {};
  a = this.serializeArray();
  $.each(a, function() {
    if (o[this.name] !== void 0) {
      if (!o[this.name].push) {
        o[this.name] = [o[this.name]];
      }
      return o[this.name].push(this.value || '');
    } else {
      return o[this.name] = this.value || '';
    }
  });
  return o;
};

console = window.console || {
  log: (function() {})
};

Tapangi = window.Tapangi = {};

Tapangi.emailRegex = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;

Tapangi.onReady = function() {
  Tapangi.onResize();
  Tapangi.initializeForm();
  return gettwitterfeed("tweets", "@polishprince");
};

Tapangi.onResize = function() {
  var navbarHeight, sectionHeight;
  navbarHeight = window.innerWidth > 979 ? parseInt($('.navbar .navbar-inner').css('height').substr(0, 3), 10) : 0;
  sectionHeight = window.innerHeight - navbarHeight;
  $(".container.body > div").css("min-height", sectionHeight);
  return $('[data-spy="scroll"]').each(function() {
    return $(this).scrollspy('refresh');
  });
};

Tapangi.initializeForm = function() {
  var $contactForm, $fields;
  console.log("initialize form");
  $contactForm = $("#contact-form");
  $contactForm.find("[type=submit]").prop('disabled', true);
  $fields = $contactForm.find("input, textarea");
  $fields.bind("change", function(event) {
    return Tapangi.validateForm($contactForm);
  });
  $contactForm.bind('submit', function(e) {
    e.preventDefault();
    if (Tapangi.validateForm($contactForm)) {
      $contactForm[0].submit();
    }
    return false;
  });
  return false;
};

Tapangi.validateForm = function($contactForm) {
  var key, validationErrors, values;
  values = $contactForm.serializeObject();
  validationErrors = [];
  console.log(values);
  for (key in values) {
    if (key !== "comment" && key !== "Field7") {
      if (values[key] === "") {
        validationErrors.push(key);
      }
    }
    if (key === "Field2" && !Tapangi.emailRegex.test(values[key])) {
      validationErrors.push(key);
    }
  }
  if (validationErrors.length === 0) {
    $contactForm.find("[type=submit]").prop('disabled', false);
    return true;
  }
  return true;
};

Tapangi.afterSubmitComplete = function(data, status) {
  console.log(status);
  return console.log(data);
};

renderfeedcell_tweets = function(data) {
  var author, html, img, text;
  console.log(data);
  text = data.text;
  author = data.from_user;
  img = data.profile_image_url;
  return html = '<div class="feedcell"><a target=_blank href="http://twitter.com/' + author + '"><img class="authorimg" src="' + img + '"></a><span class="feedtext">' + text + '</span></div>';
};

$(document).ready(Tapangi.onReady);

$(window).resize(Tapangi.onResize);

$("iframe").load(function(e) {
  $("#thanks").modal("show");
  return $("#contact-form")[0].reset();
});

$(".btn-navbar").bind('click', function() {
  $(this).toggleClass("active");
  return $(".nav-collapse li > a").bind("click", function() {
    return $(".btn-navbar").trigger('click');
  });
});
