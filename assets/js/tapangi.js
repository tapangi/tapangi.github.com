// Generated by CoffeeScript 1.3.3
var Tapangi, console;

$.fn.serializeObject = function() {
  var a, o;
  o = {};
  a = this.serializeArray();
  $.each(a, function() {
    if (o[this.name] !== void 0) {
      if (!o[this.name].push) {
        o[this.name] = [o[this.name]];
      }
      return o[this.name].push(this.value || '');
    } else {
      return o[this.name] = this.value || '';
    }
  });
  return o;
};

console = window.console || {
  log: (function() {})
};

Tapangi = window.Tapangi = {};

Tapangi.emailRegex = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;

Tapangi.onReady = function() {
  Tapangi.onResize();
  return Tapangi.initializeForm();
};

Tapangi.onResize = function() {
  var navbarHeight, sectionHeight;
  navbarHeight = parseInt($('.navbar .navbar-inner').css('height').substr(0, 3), 10);
  sectionHeight = window.innerHeight - navbarHeight;
  $(".container.body > div").css("min-height", sectionHeight);
  return $('[data-spy="scroll"]').each(function() {
    return $(this).scrollspy('refresh');
  });
};

Tapangi.initializeForm = function() {
  var $contactForm, $fields;
  console.log("initialize form");
  $contactForm = $("#contact-form");
  $contactForm.find("[type=submit]").prop('disabled', true);
  $fields = $contactForm.find("input, textarea");
  $fields.bind("change", function(event) {
    return Tapangi.validateForm($contactForm);
  });
  $contactForm.bind('submit', function(e) {
    e.preventDefault();
    if (Tapangi.validateForm($contactForm)) {
      $contactForm[0].submit();
    }
    return false;
  });
  return false;
};

Tapangi.validateForm = function($contactForm) {
  var key, validationErrors, values;
  values = $contactForm.serializeObject();
  validationErrors = [];
  console.log(values);
  for (key in values) {
    if (key !== "comment" && key !== "Field7") {
      if (values[key] === "") {
        validationErrors.push(key);
      }
    }
    if (key === "Field2" && !Tapangi.emailRegex.test(values[key])) {
      validationErrors.push(key);
    }
  }
  if (validationErrors.length === 0) {
    $contactForm.find("[type=submit]").prop('disabled', false);
    return true;
  }
  return true;
};

Tapangi.afterSubmitComplete = function(data, status) {
  console.log(status);
  return console.log(data);
};

$(document).ready(Tapangi.onReady);

$(window).resize(Tapangi.onResize);

$("iframe").load(function(e) {
  $("#thanks").modal("show");
  return $("#contact-form")[0].reset();
});
